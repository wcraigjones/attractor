- generic [ref=e2]: "{\"id\":\"cmm7wunnn0009t01iy2mmfmg4\",\"projectId\":\"cmm6xcn6c0001wb1hccxo08u9\",\"attractorDefId\":\"cmm75e4uh001zs71imzh1oea5\",\"attractorContentPath\":\"attractors/projects/cmm6xcn6c0001wb1hccxo08u9/project-task-redeploy-factory/v22.dot\",\"attractorContentVersion\":22,\"attractorContentSha256\":\"dc3cab337513b1cbe565fe4c4010eb3067f8f78a6bb0040c8a32a9900b989133\",\"githubIssueId\":null,\"githubPullRequestId\":null,\"environmentId\":\"env_default_k8s\",\"runType\":\"task\",\"sourceBranch\":\"main\",\"targetBranch\":\"main\",\"status\":\"SUCCEEDED\",\"specBundleId\":null,\"environmentSnapshot\":{\"id\":\"env_default_k8s\",\"kind\":\"KUBERNETES_JOB\",\"name\":\"default-k8s\",\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"4Gi\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"512Mi\"}},\"runnerImage\":\"582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner@sha256:ac9aab9cdf67f97af753c4a4cef6177f0bf5620a9badc7a9ac0f4d999a235901\"},\"prUrl\":null,\"error\":null,\"createdAt\":\"2026-03-01T15:34:22.788Z\",\"startedAt\":\"2026-03-01T15:34:22.840Z\",\"finishedAt\":\"2026-03-01T15:35:54.500Z\",\"githubIssue\":null,\"githubPullRequest\":null,\"environment\":{\"id\":\"env_default_k8s\",\"name\":\"default-k8s\",\"kind\":\"KUBERNETES_JOB\",\"runnerImage\":\"582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner@sha256:89aca7457f09bf6c4a09f3d48b8d1139ac48280abf1ac52cec183367eab2caa9\",\"serviceAccountName\":null,\"resourcesJson\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"4Gi\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"512Mi\"}},\"active\":true,\"createdAt\":\"2026-02-28T22:11:20.247Z\",\"updatedAt\":\"2026-03-01T15:34:43.247Z\"},\"events\":[{\"id\":\"cmm7wunns000bt01i9kbsx9kq\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:22.793Z\",\"type\":\"RunQueued\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"runType\":\"task\",\"projectId\":\"cmm6xcn6c0001wb1hccxo08u9\",\"environment\":{\"id\":\"env_default_k8s\",\"kind\":\"KUBERNETES_JOB\",\"name\":\"default-k8s\",\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"4Gi\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"512Mi\"}},\"runnerImage\":\"582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner@sha256:ac9aab9cdf67f97af753c4a4cef6177f0bf5620a9badc7a9ac0f4d999a235901\"},\"modelConfig\":{\"modelId\":\"gpt-5-codex\",\"provider\":\"openai\",\"maxTokens\":12000,\"reasoningLevel\":\"medium\"},\"runnerImage\":\"582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner@sha256:ac9aab9cdf67f97af753c4a4cef6177f0bf5620a9badc7a9ac0f4d999a235901\",\"targetBranch\":\"main\",\"attractorSnapshot\":{\"contentPath\":\"attractors/projects/cmm6xcn6c0001wb1hccxo08u9/project-task-redeploy-factory/v22.dot\",\"contentSha256\":\"dc3cab337513b1cbe565fe4c4010eb3067f8f78a6bb0040c8a32a9900b989133\",\"contentVersion\":22},\"dotImplementationWithoutSpecBundle\":false}},{\"id\":\"cmm7wunp900034x01vma7h1sz\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:22.845Z\",\"type\":\"RunDispatched\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"status\":\"RUNNING\",\"jobName\":\"factory-run-cmm7wunnn0009t01iy2mmfmg4\",\"runType\":\"task\",\"namespace\":\"factory-proj-attractor-factory\",\"environment\":{\"id\":\"env_default_k8s\",\"kind\":\"KUBERNETES_JOB\",\"name\":\"default-k8s\",\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"4Gi\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"512Mi\"}},\"runnerImage\":\"582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner@sha256:ac9aab9cdf67f97af753c4a4cef6177f0bf5620a9badc7a9ac0f4d999a235901\"}}},{\"id\":\"cmm7wup0s00015e01if0kiwui\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:24.556Z\",\"type\":\"RunStarted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"runType\":\"task\",\"sourceBranch\":\"main\",\"targetBranch\":\"main\"}},{\"id\":\"cmm7wup0w00035e01he1ah459\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:24.561Z\",\"type\":\"EnvironmentResolved\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"environment\":{\"id\":\"env_default_k8s\",\"kind\":\"KUBERNETES_JOB\",\"name\":\"default-k8s\",\"resources\":{\"limits\":{\"cpu\":\"2\",\"memory\":\"4Gi\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"512Mi\"}},\"runnerImage\":\"582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner@sha256:ac9aab9cdf67f97af753c4a4cef6177f0bf5620a9badc7a9ac0f4d999a235901\"}}},{\"id\":\"cmm7wupvf00055e01xfiaui2b\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:25.659Z\",\"type\":\"AttractorContentResolved\",\"payload\":{\"path\":\"attractors/projects/cmm6xcn6c0001wb1hccxo08u9/project-task-redeploy-factory/v22.dot\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"source\":\"snapshot\",\"attractorDefId\":\"cmm75e4uh001zs71imzh1oea5\",\"contentVersion\":22}},{\"id\":\"cmm7wupwf00075e01prjm7c55\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:25.695Z\",\"type\":\"TaskRepositorySnapshotPrepared\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"truncated\":true,\"filesIncluded\":65}},{\"id\":\"cmm7wupxu000b5e01hrn43r07\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:25.747Z\",\"type\":\"EngineNodeStarted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"start\",\"payload\":{\"type\":\"start\",\"attempt\":1}}},{\"id\":\"cmm7wupy2000f5e0105cf08l3\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:25.755Z\",\"type\":\"EngineNodeCompleted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"start\",\"payload\":{\"type\":\"start\",\"status\":\"SUCCESS\",\"attempt\":1}}},{\"id\":\"cmm7wupza000j5e01uilvte3r\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:25.799Z\",\"type\":\"EngineNodeStarted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"build_image_assets\",\"payload\":{\"type\":\"tool\",\"attempt\":1}}},{\"id\":\"cmm7wv0i7000l5e0184vw42lz\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:39.439Z\",\"type\":\"TaskToolNodeExecuted\",\"payload\":{\"cwd\":\"/tmp/factory-run-cmm7wunnn0009t01iy2mmfmg4-TumQ2T\",\"tool\":\"shell\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"build_image_assets\",\"command\":\"set -euo pipefail; API_BASE_RAW=${FACTORY_API_BASE_URL:-http://factory-api.factory-system.svc.cluster.local:8080/api}; case $API_BASE_RAW in */api) API_BASE=$API_BASE_RAW ;; *) API_BASE=$API_BASE_RAW/api ;; esac; PROJECT_ID=$(node -e 'const s=JSON.parse(process.env.RUN_EXECUTION_SPEC||\\\"{}\\\"); process.stdout.write(s.projectId||\\\"\\\")'); SECRET_NAME=${AWS_RUNTIME_SECRET_NAME:-aws-runtime-credentials}; SECRET_ID=$(curl -fsS $API_BASE/projects/$PROJECT_ID/secrets | node -e 'const fs=require(\\\"fs\\\"); const name=process.argv[1]; const data=JSON.parse(fs.readFileSync(0,\\\"utf8\\\")); const secret=(data.secrets||[]).find((s)=>s.name===name); if(!secret){process.exit(2)} process.stdout.write(secret.id);' $SECRET_NAME); mapfile -t AWS_LINES < <(curl -fsS $API_BASE/projects/$PROJECT_ID/secrets/$SECRET_ID/values | node -e 'const fs=require(\\\"fs\\\"); const d=JSON.parse(fs.readFileSync(0,\\\"utf8\\\")); const v=(d.values||{}); console.log(v.aws_access_key_id||\\\"\\\"); console.log(v.aws_secret_access_key||\\\"\\\"); console.log(v.aws_session_token||\\\"\\\");'); export AWS_ACCESS_KEY_ID=${AWS_LINES[0]:-}; export AWS_SECRET_ACCESS_KEY=${AWS_LINES[1]:-}; export AWS_SESSION_TOKEN=${AWS_LINES[2]:-}; test -n \\\"$AWS_ACCESS_KEY_ID\\\"; test -n \\\"$AWS_SECRET_ACCESS_KEY\\\"; AWS_PROFILE=${AWS_PROFILE:-}; AWS_REGION=${AWS_REGION:-us-west-2}; STACK_PREFIX=${STACK_PREFIX:-attractor-factory}; ECR_STACK_NAME=${ECR_STACK_NAME:-${STACK_PREFIX}-ecr}; IMAGE_TAG=${IMAGE_TAG:-$(date +%Y%m%d%H%M%S)}; API_REPO_URI=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION cloudformation describe-stacks --stack-name $ECR_STACK_NAME --query 'Stacks[0].Outputs[?OutputKey==`ApiRepositoryUri`].OutputValue | [0]' --output text); WEB_REPO_URI=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION cloudformation describe-stacks --stack-name $ECR_STACK_NAME --query 'Stacks[0].Outputs[?OutputKey==`WebRepositoryUri`].OutputValue | [0]' --output text); CONTROLLER_REPO_URI=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION cloudformation describe-stacks --stack-name $ECR_STACK_NAME --query 'Stacks[0].Outputs[?OutputKey==`ControllerRepositoryUri`].OutputValue | [0]' --output text); RUNNER_REPO_URI=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION cloudformation describe-stacks --stack-name $ECR_STACK_NAME --query 'Stacks[0].Outputs[?OutputKey==`RunnerRepositoryUri`].OutputValue | [0]' --output text); promote(){ local repo_uri=$1; local repo_name=${repo_uri#*/}; local latest_tag; latest_tag=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION ecr describe-images --repository-name $repo_name --filter tagStatus=TAGGED --query 'reverse(sort_by(imageDetails,&imagePushedAt))[0].imageTags[0]' --output text); if [ -z \\\"$latest_tag\\\" ] || [ \\\"$latest_tag\\\" = \\\"None\\\" ]; then echo NO_TAG_FOUND repo=$repo_name; return 1; fi; local manifest; manifest=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION ecr batch-get-image --repository-name $repo_name --image-ids imageTag=$latest_tag --query 'images[0].imageManifest' --output text); if [ -z \\\"$manifest\\\" ] || [ \\\"$manifest\\\" = \\\"None\\\" ]; then echo NO_MANIFEST repo=$repo_name tag=$latest_tag; return 1; fi; aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION ecr put-image --repository-name $repo_name --image-tag $IMAGE_TAG --image-manifest \\\"$manifest\\\" >/dev/null; echo PROMOTED repo=$repo_name from=$latest_tag to=$IMAGE_TAG; }; echo BUILD_PUSH_START tag=$IMAGE_TAG; promote $API_REPO_URI; promote $WEB_REPO_URI; promote $CONTROLLER_REPO_URI; promote $RUNNER_REPO_URI; echo IMAGE_TAG=$IMAGE_TAG > /tmp/attractor-redeploy-image-tag.env; echo BUILD_PUSH_DONE tag=$IMAGE_TAG; AWS_ENV_FILE=/tmp/attractor-redeploy-aws.env; : > $AWS_ENV_FILE; echo AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID >> $AWS_ENV_FILE; echo AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY >> $AWS_ENV_FILE; echo AWS_SESSION_TOKEN=$AWS_SESSION_TOKEN >> $AWS_ENV_FILE; echo AWS_REGION=$AWS_REGION >> $AWS_ENV_FILE; echo AWS_PROFILE=$AWS_PROFILE >> $AWS_ENV_FILE; chmod 600 $AWS_ENV_FILE\",\"timeoutMs\":900000,\"outputPreview\":\"BUILD_PUSH_START tag=20260301153425\\nPROMOTED repo=attractor-factory/factory-api from=20260301153017 to=20260301153425\\nPROMOTED repo=attractor-factory/factory-web from=20260301153017 to=20260301153425\\nPROMOTED repo=attractor-factory/factory-runner-controller from=20260301151018 to=20260301153425\\nPROMOTED repo=attractor-factory/factory-runner from=20260301152822 to=20260301153425\\nBUILD_PUSH_DONE tag=20260301153425\\n\"}},{\"id\":\"cmm7wv0ie000p5e01mvj2bj30\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:39.447Z\",\"type\":\"EngineNodeCompleted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"build_image_assets\",\"payload\":{\"type\":\"tool\",\"status\":\"SUCCESS\",\"attempt\":1}}},{\"id\":\"cmm7wv0ju000t5e018uaipluj\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:39.499Z\",\"type\":\"EngineNodeStarted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"deploy_image_assets\",\"payload\":{\"type\":\"tool\",\"attempt\":1}}},{\"id\":\"cmm7wv6tp000v5e016jd7s95z\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:47.629Z\",\"type\":\"TaskToolNodeExecuted\",\"payload\":{\"cwd\":\"/tmp/factory-run-cmm7wunnn0009t01iy2mmfmg4-TumQ2T\",\"tool\":\"shell\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"deploy_image_assets\",\"command\":\"set -euo pipefail; API_BASE_RAW=${FACTORY_API_BASE_URL:-http://factory-api.factory-system.svc.cluster.local:8080/api}; case $API_BASE_RAW in */api) API_BASE=$API_BASE_RAW ;; *) API_BASE=$API_BASE_RAW/api ;; esac; AWS_ENV_FILE=/tmp/attractor-redeploy-aws.env; if [ -f $AWS_ENV_FILE ]; then . $AWS_ENV_FILE; fi; export AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}; export AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}; export AWS_SESSION_TOKEN=${AWS_SESSION_TOKEN:-}; test -n \\\"$AWS_ACCESS_KEY_ID\\\"; test -n \\\"$AWS_SECRET_ACCESS_KEY\\\"; AWS_PROFILE=${AWS_PROFILE:-}; AWS_REGION=${AWS_REGION:-us-west-2}; STACK_PREFIX=${STACK_PREFIX:-attractor-factory}; ECR_STACK_NAME=${ECR_STACK_NAME:-${STACK_PREFIX}-ecr}; CLUSTER_NAME=${CLUSTER_NAME:-${STACK_PREFIX}-eks}; NAMESPACE=${NAMESPACE:-factory-system}; IMAGE_TAG=${IMAGE_TAG:-}; RUNNER_IMAGE_PINNED=${RUNNER_IMAGE_PINNED:-}; if [ -f /tmp/attractor-redeploy-image-tag.env ]; then . /tmp/attractor-redeploy-image-tag.env; fi; if [ -z ${IMAGE_TAG:-} ]; then IMAGE_TAG=$(date +%Y%m%d%H%M%S); fi; API_REPO_URI=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION cloudformation describe-stacks --stack-name $ECR_STACK_NAME --query 'Stacks[0].Outputs[?OutputKey==`ApiRepositoryUri`].OutputValue | [0]' --output text); WEB_REPO_URI=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION cloudformation describe-stacks --stack-name $ECR_STACK_NAME --query 'Stacks[0].Outputs[?OutputKey==`WebRepositoryUri`].OutputValue | [0]' --output text); CONTROLLER_REPO_URI=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION cloudformation describe-stacks --stack-name $ECR_STACK_NAME --query 'Stacks[0].Outputs[?OutputKey==`ControllerRepositoryUri`].OutputValue | [0]' --output text); RUNNER_REPO_URI=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION cloudformation describe-stacks --stack-name $ECR_STACK_NAME --query 'Stacks[0].Outputs[?OutputKey==`RunnerRepositoryUri`].OutputValue | [0]' --output text); RUNNER_REPO_NAME=${RUNNER_REPO_URI#*/}; RUNNER_DIGEST=$(aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION ecr describe-images --repository-name $RUNNER_REPO_NAME --image-ids imageTag=$IMAGE_TAG --query 'imageDetails[0].imageDigest' --output text); test -n \\\"$RUNNER_DIGEST\\\"; test \\\"$RUNNER_DIGEST\\\" != \\\"None\\\"; API_IMAGE=$API_REPO_URI:$IMAGE_TAG; WEB_IMAGE=$WEB_REPO_URI:$IMAGE_TAG; CONTROLLER_IMAGE=$CONTROLLER_REPO_URI:$IMAGE_TAG; RUNNER_IMAGE=$RUNNER_REPO_URI:$IMAGE_TAG; RUNNER_IMAGE_PINNED=$RUNNER_REPO_URI@$RUNNER_DIGEST; curl -fsS -X PATCH $API_BASE/environments/env_default_k8s -H 'content-type: application/json' -d '{\\\"runnerImage\\\":\\\"'$RUNNER_IMAGE_PINNED'\\\"}' >/dev/null || true; aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION eks update-kubeconfig --name $CLUSTER_NAME >/dev/null; echo DEPLOY_START tag=$IMAGE_TAG; kubectl -n $NAMESPACE set image deployment/factory-web web=$WEB_IMAGE; kubectl -n $NAMESPACE set image deployment/factory-runner-controller controller=$CONTROLLER_IMAGE; kubectl -n $NAMESPACE set image deployment/factory-api api=$API_IMAGE; if kubectl -n $NAMESPACE get deployment factory-runner >/dev/null 2>&1; then kubectl -n $NAMESPACE set image deployment/factory-runner runner=$RUNNER_IMAGE || true; fi; echo IMAGE_TAG=$IMAGE_TAG > /tmp/attractor-redeploy-image-tag.env; echo RUNNER_IMAGE_PINNED=$RUNNER_IMAGE_PINNED >> /tmp/attractor-redeploy-image-tag.env; echo DEPLOY_DONE tag=$IMAGE_TAG api=$API_IMAGE web=$WEB_IMAGE controller=$CONTROLLER_IMAGE runner=$RUNNER_IMAGE runnerPinned=$RUNNER_IMAGE_PINNED\",\"timeoutMs\":900000,\"outputPreview\":\"DEPLOY_START tag=20260301153425\\ndeployment.apps/factory-web image updated\\ndeployment.apps/factory-runner-controller image updated\\ndeployment.apps/factory-api image updated\\nDEPLOY_DONE tag=20260301153425 api=582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-api:20260301153425 web=582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-web:20260301153425 controller=582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner-controller:20260301153425 runner=582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner:20260301153425 runnerPinned=582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner@sha256:89aca7457f09bf6c4a09f3d48b8d1139ac48280abf1ac52cec183367eab2caa9\\n\"}},{\"id\":\"cmm7wv6tv000z5e017eztfkqf\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:47.636Z\",\"type\":\"EngineNodeCompleted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"deploy_image_assets\",\"payload\":{\"type\":\"tool\",\"status\":\"SUCCESS\",\"attempt\":1}}},{\"id\":\"cmm7wv6v700135e015gp1rqgi\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:34:47.684Z\",\"type\":\"EngineNodeStarted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"monitor_release\",\"payload\":{\"type\":\"tool\",\"attempt\":1}}},{\"id\":\"cmm7wwmc200155e01u73cxws0\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:35:54.386Z\",\"type\":\"TaskToolNodeExecuted\",\"payload\":{\"cwd\":\"/tmp/factory-run-cmm7wunnn0009t01iy2mmfmg4-TumQ2T\",\"tool\":\"shell\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"monitor_release\",\"command\":\"set -euo pipefail; API_BASE_RAW=${FACTORY_API_BASE_URL:-http://factory-api.factory-system.svc.cluster.local:8080/api}; case $API_BASE_RAW in */api) API_BASE=$API_BASE_RAW ;; *) API_BASE=$API_BASE_RAW/api ;; esac; AWS_ENV_FILE=/tmp/attractor-redeploy-aws.env; if [ -f $AWS_ENV_FILE ]; then . $AWS_ENV_FILE; fi; export AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}; export AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}; export AWS_SESSION_TOKEN=${AWS_SESSION_TOKEN:-}; test -n \\\"$AWS_ACCESS_KEY_ID\\\"; test -n \\\"$AWS_SECRET_ACCESS_KEY\\\"; AWS_PROFILE=${AWS_PROFILE:-}; AWS_REGION=${AWS_REGION:-us-west-2}; STACK_PREFIX=${STACK_PREFIX:-attractor-factory}; CLUSTER_NAME=${CLUSTER_NAME:-${STACK_PREFIX}-eks}; NAMESPACE=${NAMESPACE:-factory-system}; IMAGE_TAG=${IMAGE_TAG:-}; RUNNER_IMAGE_PINNED=${RUNNER_IMAGE_PINNED:-}; if [ -f /tmp/attractor-redeploy-image-tag.env ]; then . /tmp/attractor-redeploy-image-tag.env; fi; aws ${AWS_PROFILE:+--profile $AWS_PROFILE} --region $AWS_REGION eks update-kubeconfig --name $CLUSTER_NAME >/dev/null; echo MONITOR_START tag=${IMAGE_TAG:-unknown}; kubectl -n $NAMESPACE rollout status deployment/factory-web --timeout=600s; kubectl -n $NAMESPACE rollout status deployment/factory-runner-controller --timeout=600s; kubectl -n $NAMESPACE rollout status deployment/factory-api --timeout=600s; kubectl -n $NAMESPACE rollout status statefulset/postgres --timeout=600s; kubectl -n $NAMESPACE rollout status statefulset/redis --timeout=600s; kubectl -n $NAMESPACE rollout status statefulset/minio --timeout=600s; echo DEPLOYMENT_IMAGES; kubectl -n $NAMESPACE get deployment factory-api factory-web factory-runner-controller -o custom-columns=NAME:.metadata.name,IMAGES:.spec.template.spec.containers[*].image --no-headers; echo FACTORY_API_HEALTH; HEALTH_BASE=${API_BASE%/api}; curl -fsS $HEALTH_BASE/healthz; echo; echo ENVIRONMENT_RUNNER_IMAGE; ENV_RUNNER_IMAGE=$(curl -fsS $API_BASE/environments | node -e 'const fs=require(\\\"fs\\\"); const d=JSON.parse(fs.readFileSync(0,\\\"utf8\\\")); const env=(d.environments||[]).find((e)=>e.id===\\\"env_default_k8s\\\"); if(!env){process.exit(2)} process.stdout.write(env.runnerImage||\\\"\\\");'); echo $ENV_RUNNER_IMAGE; if [ -n ${RUNNER_IMAGE_PINNED:-} ]; then test \\\"$ENV_RUNNER_IMAGE\\\" = \\\"$RUNNER_IMAGE_PINNED\\\"; fi; echo MONITOR_DONE\",\"timeoutMs\":900000,\"outputPreview\":\"MONITOR_START tag=20260301153425\\ndeployment \\\"factory-web\\\" successfully rolled out\\ndeployment \\\"factory-runner-controller\\\" successfully rolled out\\nWaiting for deployment \\\"factory-api\\\" rollout to finish: 1 out of 2 new replicas have been updated...\\nWaiting for deployment \\\"factory-api\\\" rollout to finish: 1 out of 2 new replicas have been updated...\\nWaiting for deployment \\\"factory-api\\\" rollout to finish: 1 out of 2 new replicas have been updated...\\nWaiting for deployment \\\"factory-api\\\" rollout to finish: 1 old replicas are pending termination...\\nWaiting for deployment \\\"factory-api\\\" rollout to finish: 1 old replicas are pending termination...\\nWaiting for deployment \\\"factory-api\\\" rollout to finish: 1 old replicas are pending termination...\\ndeployment \\\"factory-api\\\" successfully rolled out\\npartitioned roll out complete: 1 new pods have been updated...\\npartitioned roll out complete: 1 new pods have been updated...\\npartitioned roll out complete: 1 new pods have been updated...\\nDEPLOYMENT_IMAGES\\nfactory-api 582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-api:20260301153425\\nfactory-web 582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-web:20260301153425\\nfactory-runner-controller 582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner-controller:20260301153425\\nFACTORY_API_HEALTH\\n{\\\"status\\\":\\\"ok\\\",\\\"service\\\":\\\"factory-api\\\",\\\"version\\\":\\\"unknown\\\",\\\"runnerImage\\\":\\\"582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner:20260301151932\\\"}\\nENVIRONMENT_RUNNER_IMAGE\\n582719176192.dkr.ecr.us-west-2.amazonaws.com/attractor-factory/factory-runner@sha256:89aca7457f09bf6c4a09f3d48b8d1139ac48280abf1ac52cec183367eab2caa9\\nMONITOR_DONE\\n\"}},{\"id\":\"cmm7wwmc900195e01ue7xk6gj\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:35:54.393Z\",\"type\":\"EngineNodeCompleted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"nodeId\":\"monitor_release\",\"payload\":{\"type\":\"tool\",\"status\":\"SUCCESS\",\"attempt\":1}}},{\"id\":\"cmm7wwmf5001f5e019r26qr42\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:35:54.497Z\",\"type\":\"TaskArtifactWritten\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"exitNodeId\":\"done\",\"artifactKey\":\"task-report.md\",\"finalNodeId\":\"monitor_release\",\"artifactPath\":\"runs/cmm6xcn6c0001wb1hccxo08u9/cmm7wunnn0009t01iy2mmfmg4/task-report.md\"}},{\"id\":\"cmm7wwmfg001h5e01b4xfuwgr\",\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"ts\":\"2026-03-01T15:35:54.508Z\",\"type\":\"RunCompleted\",\"payload\":{\"runId\":\"cmm7wunnn0009t01iy2mmfmg4\",\"status\":\"SUCCEEDED\",\"exitNodeId\":\"done\",\"artifactKey\":\"task-report.md\",\"finalNodeId\":\"monitor_release\",\"artifactPath\":\"runs/cmm6xcn6c0001wb1hccxo08u9/cmm7wunnn0009t01iy2mmfmg4/task-report.md\"}}]}"